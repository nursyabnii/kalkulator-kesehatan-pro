<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Kesehatan Modern</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #f1f5f9;
            font-family: 'Inter', sans-serif;
        }

        .gauge-container {
            position: relative;
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
        }

        /* Hilangkan panah spinner pada input number */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Animasi Transisi Halus */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
    </style>
</head>

<body class="text-slate-800 antialiased min-h-screen flex items-center justify-center sm:py-10">

    <div
        class="bg-white w-full sm:max-w-md sm:rounded-[2.5rem] shadow-2xl overflow-hidden min-h-screen sm:min-h-0 relative">

        <div class="p-8 pb-6 bg-gradient-to-b from-slate-50 to-white">
            <h1 class="text-2xl font-black text-center text-slate-800 tracking-tight mb-8">Cek Kesehatan Ideal</h1>

            <div class="bg-slate-100 p-1.5 rounded-2xl flex relative mb-6">
                <button onclick="setGender('female')" id="btnFemale"
                    class="flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-pink-500 bg-white shadow-sm ring-1 ring-slate-200/50">
                    <i data-lucide="venus" class="w-5 h-5"></i> Wanita
                </button>
                <button onclick="setGender('male')" id="btnMale"
                    class="flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-slate-400 hover:text-slate-600">
                    <i data-lucide="mars" class="w-5 h-5"></i> Pria
                </button>
            </div>

            <div class="grid grid-cols-3 gap-3">
                <div
                    class="bg-slate-50 rounded-2xl p-3 border border-slate-100 focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-50 transition-all text-center">
                    <label class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Usia</label>
                    <input type="number" id="age" value="24"
                        class="w-full bg-transparent text-xl font-black text-center text-slate-700 outline-none mt-1">
                </div>

                <div
                    class="bg-slate-50 rounded-2xl p-3 border border-slate-100 focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-50 transition-all text-center relative">
                    <label class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Tinggi</label>
                    <div class="flex items-center justify-center mt-1">
                        <input type="number" id="height" value="168"
                            class="w-12 bg-transparent text-xl font-black text-right text-slate-700 outline-none">
                        <span class="text-xs font-bold text-slate-400 ml-1">cm</span>
                    </div>
                </div>

                <div
                    class="bg-slate-50 rounded-2xl p-3 border border-slate-100 focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-50 transition-all text-center relative">
                    <label class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Berat</label>
                    <div class="flex items-center justify-center mt-1">
                        <input type="number" id="weight" value="64"
                            class="w-12 bg-transparent text-xl font-black text-right text-slate-700 outline-none">
                        <span class="text-xs font-bold text-slate-400 ml-1">kg</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="px-8 text-center mt-2 relative">
            <div class="inline-block px-4 py-1.5 rounded-full bg-slate-100 mb-2">
                <p class="text-[10px] font-black uppercase tracking-widest" id="topStatus">Status Kesehatan</p>
            </div>

            <div class="gauge-container mt-4">
                <canvas id="bmiChart"></canvas>
                <div class="absolute inset-0 flex flex-col items-center justify-end pb-4">
                    <span id="imtValue"
                        class="text-[3.5rem] font-black tracking-tighter leading-none transition-colors">0.0</span>
                    <span class="text-slate-400 text-xs font-black uppercase tracking-widest mt-1">NILAI IMT</span>
                </div>
            </div>
        </div>

        <div class="px-8 pb-8 pt-4">

            <div class="flex justify-between items-end mb-6 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                <div>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Kategori Saat Ini</p>
                    <p id="katLabel" class="font-black text-lg leading-tight transition-colors">-</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Selisih ke Ideal</p>
                    <p id="selisihLabel" class="font-black text-lg leading-tight transition-colors">0 kg</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-8">
                <div class="p-3.5 rounded-2xl border border-blue-100 bg-blue-50/50">
                    <div class="flex items-center gap-1.5 mb-1">
                        <i data-lucide="target" class="w-3.5 h-3.5 text-blue-500"></i>
                        <span class="text-[9px] font-black text-blue-500 uppercase tracking-wider">Berat Ideal</span>
                    </div>
                    <p id="beratIdeal" class="font-black text-lg text-slate-700">0 kg</p>
                    <p class="text-[9px] text-slate-500 font-medium leading-tight mt-0.5">Rumus spesifik gender</p>
                </div>

                <div class="p-3.5 rounded-2xl border border-emerald-100 bg-emerald-50/50">
                    <div class="flex items-center gap-1.5 mb-1">
                        <i data-lucide="shield-check" class="w-3.5 h-3.5 text-emerald-500"></i>
                        <span class="text-[9px] font-black text-emerald-500 uppercase tracking-wider">Batas Sehat</span>
                    </div>
                    <p id="rangeNormal" class="font-black text-lg text-slate-700">0 - 0 kg</p>
                    <p class="text-[9px] text-slate-500 font-medium leading-tight mt-0.5">Standar IMT Normal WHO</p>
                </div>
            </div>

            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-3 px-1">Rincian Skala Medis</p>
            <div id="categoryTable" class="space-y-1.5 text-xs"></div>

            <div class="mt-8 text-center border-t border-gray-100 pt-5">
                <p class="text-[9px] font-bold text-gray-400 uppercase tracking-[0.2em]">
                    &copy; 2026 Cek Kesehatan Ideal
                </p>
            </div>
        </div>

    </div>

    <script>
        let bmiChart;
        let currentGender = 'female';

        // Styling plugin untuk jarum grafik yang lebih modern
        const pointPlugin = {
            id: 'pointIndicator',
            afterDraw: (chart) => {
                const { ctx, chartArea: { width } } = chart;
                ctx.save();
                const val = chart.config.options.imtValue;
                const color = chart.config.options.indicatorColor || '#1e293b';

                let angle = Math.PI + (Math.PI * (Math.min(Math.max(val, 15), 40) - 15) / 25);
                const cx = width / 2;
                const cy = chart._metasets[0].data[0].y;
                const outerRadius = chart._metasets[0].data[0].outerRadius;

                const x = cx + Math.cos(angle) * outerRadius;
                const y = cy + Math.sin(angle) * outerRadius;

                // Outer ring
                ctx.beginPath(); ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fillStyle = 'white'; ctx.fill();
                ctx.shadowColor = 'rgba(0,0,0,0.15)'; ctx.shadowBlur = 4; ctx.shadowOffsetY = 2;

                // Inner dot
                ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fillStyle = color; ctx.fill();
                ctx.restore();
            }
        };

        function getCategories(age) {
            if (age < 18) {
                return [
                    { label: "BB Kurang", min: 0, max: 17.8, text: "≤ 17.8", color: "#3B82F6" },
                    { label: "Normal", min: 17.9, max: 22.7, text: "17.9 - 22.7", color: "#10B981" },
                    { label: "Kelebihan Bobot", min: 22.8, max: 24.1, text: "22.8 - 24.1", color: "#F59E0B" },
                    { label: "Obesitas", min: 24.2, max: 100, text: "≥ 24.2", color: "#EF4444" }
                ];
            }
            return [
                { label: "Sangat Kurang", min: 0, max: 16.9, text: "< 16.9", color: "#3B82F6" },
                { label: "Kurang Bobot", min: 17.0, max: 18.4, text: "17.0 - 18.4", color: "#60A5FA" },
                { label: "Normal", min: 18.5, max: 24.9, text: "18.5 - 24.9", color: "#10B981" },
                { label: "Kelebihan Bobot", min: 25.0, max: 29.9, text: "25.0 - 29.9", color: "#F59E0B" },
                { label: "Obesitas Kelas I", min: 30.0, max: 34.9, text: "30.0 - 34.9", color: "#F97316" },
                { label: "Obesitas Kelas II", min: 35.0, max: 39.9, text: "35.0 - 39.9", color: "#EF4444" },
                { label: "Obesitas Kelas III", min: 40.0, max: 100, text: "≥ 40.0", color: "#B91C1C" }
            ];
        }

        function setGender(g) {
            currentGender = g;
            const btnF = document.getElementById('btnFemale');
            const btnM = document.getElementById('btnMale');

            if (g === 'female') {
                btnF.className = "flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-pink-500 bg-white shadow-sm ring-1 ring-slate-200/50";
                btnM.className = "flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-slate-400 hover:text-slate-600";
            } else {
                btnM.className = "flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-blue-500 bg-white shadow-sm ring-1 ring-slate-200/50";
                btnF.className = "flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-all text-slate-400 hover:text-slate-600";
            }
            updateAnalysis();
        }

        function updateAnalysis() {
            const h = parseFloat(document.getElementById('height').value);
            const w = parseFloat(document.getElementById('weight').value);
            const age = parseInt(document.getElementById('age').value);

            if (isNaN(h) || isNaN(w) || isNaN(age) || h <= 0) return;

            const hM = h / 100;
            const imt = (w / (hM * hM)).toFixed(1);

            const cats = getCategories(age);
            let currentCat = cats[0];
            for (let c of cats) { if (imt >= c.min) currentCat = c; }

            // Rumus Broca (Target Ideal Pasti)
            const base = h - 100;
            const multiplier = currentGender === 'male' ? 0.9 : 0.85;
            const beratIdeal = (base * multiplier).toFixed(1);

            // Rentang Aman WHO
            const minImt = age < 18 ? 17.9 : 18.5;
            const maxImt = age < 18 ? 22.7 : 24.9;
            const minNormalWeight = (minImt * hM * hM).toFixed(1);
            const maxNormalWeight = (maxImt * hM * hM).toFixed(1);

            // Selisih
            const diff = (w - beratIdeal).toFixed(1);
            let selisihText = diff > 0 ? `+${diff} kg (Turunkan)` : (diff < 0 ? `${diff} kg (Naikkan)` : `Sempurna!`);

            // Update DOM
            document.getElementById('imtValue').innerText = imt;
            document.getElementById('katLabel').innerText = currentCat.label;
            document.getElementById('topStatus').innerText = currentCat.label;
            document.getElementById('beratIdeal').innerText = `${beratIdeal} kg`;
            document.getElementById('rangeNormal').innerText = `${minNormalWeight} - ${maxNormalWeight} kg`;
            document.getElementById('selisihLabel').innerText = selisihText;

            // Warnai elemen
            const color = currentCat.color;
            document.getElementById('imtValue').style.color = color;
            document.getElementById('katLabel').style.color = color;
            document.getElementById('selisihLabel').style.color = color;
            document.getElementById('topStatus').style.color = color;

            // Render Table yang Rapi
            const table = document.getElementById('categoryTable');
            table.innerHTML = '';
            cats.forEach(cat => {
                const isActive = currentCat.label === cat.label;
                const row = document.createElement('div');
                row.className = `flex justify-between text-xs py-2 px-3 rounded-xl transition-all ${isActive ? 'bg-slate-100 font-black' : 'text-slate-400 font-medium'}`;
                if (isActive) row.style.color = color;

                row.innerHTML = `
                    <div class="flex items-center gap-2">
                        ${isActive ? `<div class="w-1.5 h-1.5 rounded-full" style="background-color: ${color}"></div>` : '<div class="w-1.5 h-1.5 rounded-full bg-transparent"></div>'}
                        <span>${cat.label}</span>
                    </div>
                    <span>${cat.text}</span>
                `;
                table.appendChild(row);
            });

            initChart(imt, color);
        }

        function initChart(value, color) {
            const ctx = document.getElementById('bmiChart').getContext('2d');
            if (bmiChart) bmiChart.destroy();
            bmiChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [1, 1, 1, 2, 5],
                        backgroundColor: ['#93C5FD', '#60A5FA', '#10B981', '#FBBF24', '#EF4444'],
                        borderWidth: 0, circumference: 180, rotation: 270, cutout: '85%',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    imtValue: value,
                    indicatorColor: color,
                    layout: { padding: 10 },
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                },
                plugins: [pointPlugin]
            });
        }

        window.onload = () => {
            lucide.createIcons();
            ['age', 'height', 'weight'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateAnalysis);
            });
            updateAnalysis();
        };
    </script>
</body>

</html>